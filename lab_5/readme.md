Лабораторная работа № 5
`1.` Используя creat(), write(), fflush(), close(), gettimeofday(), разработать программу, которая
открывает файл,
записывает туда 300 KB,
очищает все записи,
закрывает и
удаляет файл,
а также измеряет и выводит время, затраченное на каждое действие.

Системный вызов  creat()  либо создает  новый файл,
         либо открывает и чистит существующий. Вторым параметом надо указать режим(чтения либо записи).

int write(int handle, void *buf, int count)-
Функция write() переписывает count байт из буфера, на который указывает bufy в файл, соот­ветствующий дескриптору файла handle. 

int gettimeofday(struct timeval *tv, struct timezone *tz) - позволяет получить время в виде структуры timeval (вторая структура -- timezone считается устаревшей и при вызове заменяется NULL'ом):

struct timeval {

    time_t      tv_sec;     /* seconds */
    suseconds_t tv_usec;    /* microseconds */
};
                                                            
которая содержит число секунд и микросекунд, прошедших с 1-го января 1970 г. 00:00:00 Всемирного времени. Имеется в виду, что с начального момента прошло tv_sec секунд и еще tv_usec микросекунд.                 

`2.` Разработать программу, которая замеряет время для 300,000 однобайтовых записей с использованием

a) напрямую POSIX: creat(), write(), close().

b) с использованием библиотеки stdio (напр., fopen(), fwrite(), and fclose()).

Сравнить и объяснить результаты.

В результате выполнения программы, выяснилось, что времени для осуществления всех действий с использованием библиотеки <stdio.h> потребовалось меньше, чем напрямую с POSIX. Происходит так, потому что POSIX обращается каждый раз на прямую, а библиотека использует буферизацию.

`3.` Разработать собственную версию (mytail) команды tail.
Формат: mytail -n file
Она читает блок из конца файла, просматривает его с конца до заданного количества строк n и печатает эти строки
в соответствующем порядке.
Использовать: stat(), lseek(), open(), read(), close(), ...

int stat(pathname, buffer); - Функция stat получает информацию о  файле  или  директории,
                                       определенном по pathname, и запоминает ее в структуре, на которую
                                       указывает  buffer.  
                                       
int fseek (FILE *stream, long offset, int origin); - Функция fseek() устанавливает указатель положения в файле, связанном со stream, в соответ­ствии со значениями offset и origin. Ее основное назначение — поддерживать операции ввода/ вывода по произвольному адресу. Аргумент offset — это выраженный в байтах сдвиг от позиции, определяемой origin, до новой позиции. Аргумент origin может принимать значения 0, 1 или 2, причем 0 означает начало файла, 1 — текущую позицию, а 2 — конец файла.                                       

                                               
`4.` Разработать собственную версию (mystat) команды stat, которая просто осуществляет системный вызов stat(), выводит
     размер, число задействованных блоков, число жестких ссылок и т. д.            

            
Имя файла, ссылающееся на его индексный дескриптор, называется жесткой ссылкой. Механизм жестких ссылок – это основной способ обращаться к файлу в Unix-подобных операционных системах вся информация о файле привязана не к его имени, а так называемому числовому индексному дескриптору. У каждого файла есть свой уникальный индексный дескриптор, к которому привязаны сведения об этом файле: в каких блоках диска хранится его содержимое, размер, время создания, модификации и др.
                                                            
`5.` Разработать собственную версию (myls) команды ls, которая выводит список файлов в заданной директории.
С ключом -l она выводит информацию о каждом файле, включая собственника, группу, разрешения и т.д., получаемые из системного
вызова stat().
Формат: myls -l directory (или текущую директорию, если параметр не задан)
Использовать: stat(), opendir(), readdir(), getcwd(), ... 

int closedir(DIR *ptr)

DIR *opendir(char *dirname)  

Функция opendir() открывает поток каталога и возвращает указатель на структуру типа DIR, которая содержит информацию о каталоге. Не следует модифицировать содержимое данной струк­туры. Функция closedir() закрывает поток каталога, на который указывает ptr.

Функция readdir() возвращает название следующего файла в каталоге. Иными словами, функ­ция readdir() читает оглавление каталога по одному файлу за раз. Параметр ptr должен указы­вать на поток каталога, открытый с помощью opendir().                                                         

char *getcwd(char *dir, int len)

Функция getcwd() копирует полный путь (максимум len символов) текущего рабочего каталога диска в строку, на которую указывает параметр dir. Если полный путь длиннее, чем len символов, то возникает ошибка. Функция getcwd() возвращает указатель на dir. 


